# 3 лабораторная работа по предмету "Бизнес логика программных систем"

## Авторы

- Калинин Даниил Дмитриевич P33141 - https://github.com/DanKalinin125
- Ушаков Максим Евгеньевич P33141 - https://github.com/dmeaaxd

## Общие сведения

Составляющие 3 лабораторной работы:

- Основной функционал с REST API - [BLPS_lab3_Monolit](https://github.com/dmeaaxd/BLPS_lab3_Monolit/tree/master)
- Сервис отправки почтовых нотификаций - [BLPS_lab3_NotificationService](https://github.com/dmeaaxd/BLPS_lab3_NotificationService)
- Сервис осуществления финансовых операций - [BLPS_lab3_PaymentService](https://github.com/dmeaaxd/BLPS_lab3_PaymentService)

Проект представляет собой backend для сайта-агрегатора промокодов (предложений) из разных интернет-магазинов. За основу взят сайт https://letyshops.com/us

### Краткие требования к реализации

- Требования к авторизации - **Spring Security**
- Асинхронное выполнение задач должно использовать модель доставки "очередь сообщений".
- В качестве провайдера сервиса асинхронного обмена сообщениями необходимо использовать очередь сообщений на базе **Apache ActiveMQ**.
- Для отправки сообщений необходимо использовать **JMS API**.
- Для получения сообщений необходимо использовать **JMS API**.

## Роли

- **Пользователь** - клиент приложения, основной целью которого является просмотр представленных магазинов и предложений (промокодов) каждого магазина
- **Системный администратор** - пользователь, основной задачей которого является администрирование агрегатора: управление списком категорий магазинов, создание и удаление магазинов, управление списком администраторов каждого магазина
- **Администратор магазина** -  администратор конкретного магазина, отвечает за редактирование магазина и управление предложениями конкретного магазина

## Функциональности и бизнес процессы

### Авторизация и регистрация

| Функциональность / Роль | Пользователь | Системный администратор | Администратор магазина |
|-------------------------|--------------|-------------------------|------------------------|
| Авторизация             | +            | +                       | +                      |
| Регистрация             | +            | +                       | +                      |
| Восстановление пароля   | +            | +                       | +                      |

### Категории магазинов

| Функциональность / Роль   | Пользователь | Системный администратор | Администратор магазина |
|---------------------------|--------------|-------------------------|------------------------|
| Просмотр списка категорий | +            | +                       | +                      |
| Создание категории        |              | +                       |                        |
| Редактирование категории  |              | +                       |                        |
| Удаление категории        |              | +                       |                        |

### Магазины

| Функциональность / Роль                                                  | Пользователь | Системный администратор | Администратор магазина |
|--------------------------------------------------------------------------|--------------|-------------------------|------------------------|
| Просмотр списка магазинов                                                | +            | +                       | +                      |
| Создание магазина                                                        |              | +                       |                        |
| Просмотр карточки магазина<br/>(Просмотр свойств и предложений магазина) | +            | +                       | +                      |
| Редактирование магазина                                                  |              |                         | +                      |
| Удаление магазина                                                        |              | +                       |                        |

### Администраторы магазинов

| Функциональность / Роль                                                  | Пользователь | Системный администратор | Администратор магазина |
|--------------------------------------------------------------------------|--------------|-------------------------|------------------------|
| Просмотр списка администраторов магазина                                 |              | +                       |                        |
| Редактирование списка администраторов магазина                           |              | +                       |                        |

### Предложения магазина

| Функциональность / Роль              | Пользователь | Системный администратор | Администратор магазина |
|--------------------------------------|--------------|-------------------------|------------------------|
| Создание предложения                 |              |                         | +                      |
| Просмотр карточки предложения        | +            | +                       | +                      |
| Редактирование предложения           |              |                         | +                      |
| Удаление предложения                 |              |                         | +                      |

### Избранное

**Избранное** - возможность пользователей сохранить магазин в личную подборку для более быстрого обращения к нему

| Функциональность / Роль             | Пользователь | Системный администратор | Администратор магазина |
|-------------------------------------|--------------|-------------------------|------------------------|
| Просмотр списка избранных магазинов | +            | +                       | +                      |
| Добавление магазина в избранное     | +            | +                       | +                      |
| Удаление магазина из избранного     | +            | +                       | +                      |

### Подписки

**Подписка** - платная возможность получения уведомлений о новых предложениях магазина

| Функциональность / Роль           | Пользователь | Системный администратор | Администратор магазина |
|-----------------------------------|--------------|-------------------------|------------------------|
| Просмотр списка активных подписок | +            | +                       | +                      |
| Оформление подписки на магазин    | +            | +                       | +                      |
| Продление подписки на магазин     | +            | +                       | +                      |

### Управление локальным счетом

Локальный счет - финансовый счет пользователя в системе, измеряется в у.е.

| Функциональность / Роль       | Пользователь | Системный администратор | Администратор магазина |
|-------------------------------|--------------|-------------------------|------------------------|
| Просмотр состояния счета      | +            | +                       | +                      |
| Пополнение счета              | +            | +                       | +                      |

## Периодические задачи по рассписанию

Планировщик задач - **Quartz**

Задачи:

- Ежедневные уведомления по email с предложением по подписке на магазины, которые находятся в избранном, но при этом их нет в подписке пользователя 
- Проверка на окончание подписки на магазины и удаление окончившихся подписок


## Архитектура системы

Monolit - основной сервис с API
Apache ActiveMQ - брокер сообщений
NotificationService - сервис уведомлений по почте
PaymentService - сервис проведения финансовых операций: пополнения, списания

(Оранжевым указаны таблицы БД, оранжевые стрелки - работа с БД)

![Архитектура](images/arch.png)

> Проект является учебным, архитектура адаптирована под условия задания. Необходимо учитывать, что на реальных проектах Monolit необходимо разделить на отдельные сервисы и дать возможность каждому сервису работать только со своей БД, если иное не предусмотрено нефункциональными требованиями 

## Структура БД

![Структура БД](images/database_erd.png)

## REST API

Исходный документ openapi - [openapi.yaml](openapi.yaml)

Для просмотра API рекомендуется загрузить вышепредставленный файл на сайт https://editor.swagger.io/

![api_1](images/api_1.png)

![api_2](images/api_2.png)

![api_3](images/api_3.png)

![api_4](images/api_4.png)

![api_5](images/api_5.png)

![api_6](images/api_6.png)

![api_7](images/api_7.png)

![api_8](images/api_8.png)